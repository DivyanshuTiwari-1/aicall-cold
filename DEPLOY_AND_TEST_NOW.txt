â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                            â•‘
â•‘     SIMPLIFIED AUTOMATED CALLS - DEPLOY & TEST NOW         â•‘
â•‘                  Telnyx Call Control API                   â•‘
â•‘                                                            â•‘
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—


ğŸ¯ WHAT'S NEW:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… No AGI server needed (port 4573 removed)
âœ… Direct Telnyx Call Control API integration
âœ… 70% less code (from 2000+ to 600 lines)
âœ… Webhook-based AI conversations
âœ… Enhanced knowledge base queries
âœ… Same cost: $0.055 per 5-min call
âœ… Manual browser phone calls still work
âœ… Piper TTS + Vosk STT (free, local)


1ï¸âƒ£ SSH TO YOUR SERVER:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ssh ubuntu@13.53.89.241


2ï¸âƒ£ DEPLOY & TEST IN ONE COMMAND:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Copy and paste this ENTIRE command once connected:

cd /opt/ai-dialer && \
git pull origin main && \
chmod +x deploy-simplified-calls.sh test-simplified-calls.sh && \
./deploy-simplified-calls.sh && \
sleep 10 && \
./test-simplified-calls.sh


3ï¸âƒ£ WHAT THIS DOES:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Step 1: Pull latest code from GitHub âœ“
Step 2: Make scripts executable âœ“
Step 3: Deploy simplified system:
  - Stop containers
  - Rebuild with new code
  - Start services
  - Verify logs show "Telnyx Call Control API"

Step 4: Wait 10 seconds for services to stabilize

Step 5: Run test with 8 phone numbers:
  - +14154305
  - +15127510
  - +12023214
  - +12032472
  - +12063849
  - +12103167
  - +12139780
  - +12153561


4ï¸âƒ£ WHAT YOU'LL SEE:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

During deployment:
  âœ… Pulling latest code from Git...
  âœ… Stopping current containers...
  âœ… Rebuilding containers with new code...
  âœ… Services started
  âœ… Automated calls configured via Telnyx Call Control API (webhook-based)
  âœ… Manual Bridge Stasis App registered (for browser phone)

During test:
  1ï¸âƒ£  Logging in...
  2ï¸âƒ£  Creating test campaign...
  3ï¸âƒ£  Adding 8 test contacts...
  4ï¸âƒ£  Getting phone number...
  5ï¸âƒ£  Starting automated call queue...
  ğŸ“ Automated calls are now being made

Then you'll see real-time progress:
  ğŸ“ Telnyx webhook received: call.answered
  ğŸ¤ AI greeting played to customer
  ğŸ“¼ Recording saved for call...
  ğŸ—£ï¸  Customer said: [transcription]
  ğŸ“ Stored conversation turn...
  ğŸ“´ Call ended: duration: XXs


5ï¸âƒ£ MONITOR IN REAL-TIME:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Option A - Watch Logs (from SSH):
docker-compose logs -f ai_dialer | grep -E "Telnyx|webhook|Call"

Option B - Web Interface:
https://atsservice.site/live-monitor

You should see:
  âœ… Active calls updating in real-time
  âœ… Conversation turns appearing as they happen
  âœ… Green "Connected" WebSocket status


6ï¸âƒ£ VERIFY RESULTS:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Check database (from SSH):

docker-compose exec postgres psql -U postgres -d ai_dialer -c "
  SELECT 
    id, 
    status, 
    outcome, 
    duration, 
    cost,
    to_char(created_at, 'HH24:MI:SS') as time
  FROM calls 
  WHERE call_type = 'automated'
  AND created_at > NOW() - INTERVAL '10 minutes'
  ORDER BY created_at DESC;
"

Expected output:
 status    | outcome    | duration | cost  | time
-----------+------------+----------+-------+---------
 completed | interested |      180 | 0.033 | 14:23:45
 completed | completed  |      120 | 0.022 | 14:22:10
 completed | interested |       90 | 0.017 | 14:20:35


7ï¸âƒ£ COST ESTIMATE:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

8 test calls Ã— 2-3 minutes average:
  â€¢ Telnyx calling: ~$0.15 total
  â€¢ Piper TTS: FREE (local)
  â€¢ Vosk STT: FREE (local)

Total cost: ~$0.15


8ï¸âƒ£ CONFIGURE TELNYX WEBHOOK (IMPORTANT!):
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Before testing, ensure this is configured:

1. Go to: https://portal.telnyx.com/#/app/connections
2. Select Connection: 2811216964129653991
3. Set Webhook URL: https://atsservice.site/api/v1/webhooks/telnyx
4. Set Method: POST
5. Enable these events:
   âœ… call.initiated
   âœ… call.answered
   âœ… call.playback.ended
   âœ… call.recording.saved
   âœ… call.hangup
   âœ… call.speak.ended
6. SAVE


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                            â•‘
â•‘     ğŸš¨ BEFORE YOU START - WEBHOOK MUST BE CONFIGURED! ğŸš¨   â•‘
â•‘                                                            â•‘
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Without webhook configuration, calls will connect but AI won't respond!


TROUBLESHOOTING:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Problem: "No webhooks received"
Solution: 
  â€¢ Check Telnyx webhook URL is set
  â€¢ Verify https://atsservice.site is accessible
  â€¢ Check: curl https://atsservice.site/api/v1/webhooks/telnyx

Problem: "No audio playing"
Solution:
  â€¢ Check Piper service: docker-compose exec ai_dialer ls /app/audio/piper/
  â€¢ Test TTS: curl localhost:3000/api/v1/asterisk/tts/generate

Problem: "Transcription not working"
Solution:
  â€¢ Check Vosk service logs: docker-compose logs ai_dialer | grep vosk

Problem: "TELNYX_API_KEY not set"
Solution:
  â€¢ Already configured in docker-compose.yml âœ“
  â€¢ Restart: docker-compose down && docker-compose up -d


MANUAL COMMANDS (if needed):
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

# Deploy only (no test):
./deploy-simplified-calls.sh

# Test only (after deployment):
./test-simplified-calls.sh

# Check service status:
docker-compose ps

# View logs:
docker-compose logs -f ai_dialer

# Stop queue:
curl -X POST http://localhost:3000/api/v1/calls/automated/stop \
  -H "Authorization: Bearer $TOKEN" \
  -d '{"campaignId":"your_campaign_id"}'

# Restart services:
docker-compose restart ai_dialer


WHAT'S DIFFERENT FROM OLD SYSTEM:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

OLD (Asterisk/AGI):
  âŒ FastAGI TCP server on port 4573
  âŒ Complex Stasis app routing
  âŒ AGI protocol overhead
  âŒ 2000+ lines of code
  âŒ Hard to debug

NEW (Telnyx Direct):
  âœ… Direct Telnyx Call Control API
  âœ… Webhook-based (HTTPS)
  âœ… Simple, clean architecture
  âœ… 600 lines of code
  âœ… Easy debugging via logs
  âœ… Same features, same cost


SUCCESS INDICATORS:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… Logs show: "Automated calls configured via Telnyx Call Control API"
âœ… No mention of "FastAGI" or "port 4573" in logs
âœ… Webhooks received: "Telnyx webhook received: call.answered"
âœ… Conversations appear in Live Monitor in real-time
âœ… Transcripts saved in Call History
âœ… Manual browser phone still works


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                            â•‘
â•‘     âœ… READY! JUST COPY THE COMMANDS ABOVE AND RUN! âœ…      â•‘
â•‘                                                            â•‘
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


Timeline:
  00:00 - SSH into server
  00:10 - Run deployment command
  02:00 - Services deployed and started
  02:10 - Test script starts
  02:20 - First call dialing
  02:30 - Conversation begins
  05:00 - All 8 calls completed
  05:10 - Results displayed

Total time: ~5 minutes from start to finish!


Your Production URLs:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Web Interface: https://atsservice.site/
Live Monitor: https://atsservice.site/live-monitor
Call History: https://atsservice.site/calls
Webhook URL: https://atsservice.site/api/v1/webhooks/telnyx


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    ğŸš€ LET'S GO! ğŸš€                          â•‘
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

