[global]
type=global
endpoint_identifier_order=ip,username,anonymous

[transport-udp]
type=transport
protocol=udp
bind=0.0.0.0:5060

[transport-tcp]
type=transport
protocol=tcp
bind=0.0.0.0:5060

; WebRTC Transport for Softphone
[transport-wss]
type=transport
protocol=wss
bind=0.0.0.0:8089
cert_file=/etc/asterisk/keys/asterisk.pem
priv_key_file=/etc/asterisk/keys/asterisk.key
method=tlsv1_2
cipher=ECDHE+AESGCM:ECDHE+CHACHA20:DHE+AESGCM:DHE+CHACHA20:!aNULL:!MD5:!DSS

; WebRTC Transport for HTTP (fallback)
[transport-ws]
type=transport
protocol=ws
bind=0.0.0.0:8088

; Telnyx SIP Trunk Configuration (Outbound)
[telnyx_outbound]
type=endpoint
transport=transport-udp
context=ai-dialer-outbound
disallow=all
allow=ulaw,alaw,g722,g729
direct_media=no
rtp_symmetric=yes
force_rport=yes
rewrite_contact=yes
from_user=info@pitchnhire.com
from_domain=sip.telnyx.com
outbound_auth=telnyx_auth
aors=telnyx_aor
callerid="AI Dialer" <+18058690081>
callerid_privacy=allowed_not_screened
callerid_tag=ai-dialer
dtmf_mode=rfc4733
send_pai=yes
send_rpid=yes
trust_id_inbound=yes
trust_id_outbound=yes

[telnyx_aor]
type=aor
contact=sip:sip.telnyx.com
qualify_frequency=30
qualify_timeout=3
remove_existing=yes
maximum_contacts=1
remove_unavailable=yes

; Telnyx Registration (for outbound auth-based trunk)
[telnyx_registration]
type=registration
outbound_auth=telnyx_auth
server_uri=sip:sip.telnyx.com
client_uri=sip:info@pitchnhire.com@sip.telnyx.com
contact_user=info@pitchnhire.com
retry_interval=60
transport=transport-udp

[telnyx_auth]
type=auth
auth_type=userpass
username=info@pitchnhire.com
password=DxZU$m4#GuFhRTp

[telnyx_identify]
type=identify
endpoint=telnyx_outbound
match=66.109.0.0/16

; Telnyx Inbound Configuration
[telnyx_inbound_endpoint]
type=endpoint
transport=transport-udp
context=ai-dialer-inbound
disallow=all
allow=ulaw,alaw,g722,g729
direct_media=no
rtp_symmetric=yes
force_rport=yes
rewrite_contact=yes
trust_id_inbound=yes
trust_id_outbound=yes
callerid_privacy=allowed_not_screened

[telnyx_inbound_identify]
type=identify
endpoint=telnyx_inbound_endpoint
match=66.109.0.0/16

; Agent WebRTC Endpoints Template
[agent_template](!)
type=endpoint
transport=transport-wss
context=manual-dialer-bridge
disallow=all
allow=ulaw,alaw,g722,opus
direct_media=no
rtp_symmetric=yes
force_rport=yes
rewrite_contact=yes
dtmf_mode=rfc4733
dtmf_send_mode=rfc4733
send_pai=yes
send_rpid=yes
trust_id_inbound=yes
trust_id_outbound=yes
ice_support=yes
use_avpf=yes
media_encryption=sdes
encryption=yes
rtcp_mux=yes
rtp_timeout=60
rtp_timeout_hold=300

; Agent AOR Template
[agent_aor_template](!)
type=aor
max_contacts=1
qualify_frequency=30
qualify_timeout=3
remove_existing=yes
remove_unavailable=yes

; Agent Auth Template
[agent_auth_template](!)
type=auth
auth_type=userpass

; Agent Identify Template
[agent_identify_template](!)
type=identify
endpoint=agent_template

; Local endpoint for testing
[local_endpoint]
type=endpoint
transport=transport-udp
context=ai-dialer
disallow=all
allow=ulaw,alaw,g722
direct_media=no

; Optional local endpoint for testing
[local]
type=endpoint
transport=transport-udp
context=from-internal
disallow=all
allow=ulaw
aors=local_aor

[local_aor]
type=aor
max_contacts=1

; Include dynamic agent configurations
#include pjsip_dynamic.conf
